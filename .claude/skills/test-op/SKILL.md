---
name: test-op
description: ç®—å­ç²¾åº¦æµ‹è¯•å…¥å£ - å››é˜¶æ®µå·¥ä½œæµ
---

# ç®—å­ç²¾åº¦æµ‹è¯•

> [!CAUTION]
> **å¿…é¡»å‰å°äº¤äº’å¼æ‰§è¡Œ - ç¦æ­¢åå°è¿è¡Œ**
> 
> æ‰§è¡Œæ­¤æŠ€èƒ½æ—¶å¿…é¡»ï¼š
> 1. åœ¨å‰å°é€æ­¥æ‰§è¡Œæ¯ä¸ªé˜¶æ®µ
> 2. æ¯ä¸ªé˜¶æ®µå®Œæˆå**åœæ­¢å¹¶ç­‰å¾…ç”¨æˆ·ç¡®è®¤**
> 3. æ‰€æœ‰å‘½ä»¤è¾“å‡ºå¯¹ç”¨æˆ·å¯è§
> 4. ç”¨æˆ·å¯éšæ—¶ä¸­æ–­æˆ–æä¾›åé¦ˆ

---

## å·¥ä½œæµç¨‹

```
/test-op [ç®—å­æ–‡ä»¶]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 1ï¼šåˆ†æ                        â”‚
â”‚  â†’ /analyze-operator                 â”‚
â”‚  â†’ è¯†åˆ« CPU/NPU å…¥å£ + æå– __main__ â”‚
â”‚  â†’ ğŸ”´ å±•ç¤ºåˆ†æç»“æœï¼Œè¯·æ±‚ç¡®è®¤         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ç”¨æˆ·ç¡®è®¤ âœ“
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 2ï¼šè§„åˆ’                        â”‚
â”‚  â†’ /plan-and-confirm                 â”‚
â”‚  â†’ ç”Ÿæˆæµ‹è¯•è®¡åˆ’                      â”‚
â”‚  â†’ ğŸ”´ å±•ç¤ºè®¡åˆ’ï¼Œè¯·æ±‚æ‰¹å‡†             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ç”¨æˆ·æ‰¹å‡† âœ“
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 3ï¼šç¼–å†™ä¸éªŒè¯                  â”‚
â”‚  â†’ /write-and-verify                 â”‚
â”‚  â†’ ç”Ÿæˆ test_<opname>.py             â”‚
â”‚  â†’ å¾ªç¯éªŒè¯ç›´è‡³å¤ç°åŸ __main__ æµ‹è¯•   â”‚
â”‚  â†’ ğŸ”´ éªŒè¯é€šè¿‡åè¯·æ±‚ç¡®è®¤             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ ç”¨æˆ·ç¡®è®¤ âœ“
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 4ï¼šæ‰©å±•ä¸æŠ¥å‘Š                  â”‚
â”‚  â†’ /extend-and-report                â”‚
â”‚  â†’ æ·»åŠ æ‰©å±•ç”¨ä¾‹ï¼Œè¿è¡Œå…¨éƒ¨æµ‹è¯•        â”‚
â”‚  â†’ å¯¼å‡º CSVï¼Œç”ŸæˆæŠ¥å‘Š                â”‚
â”‚  â†’ ğŸ”´ å±•ç¤ºç»“æœ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å„é˜¶æ®µèŒè´£

| é˜¶æ®µ | Skill | è¾“å‡º |
|------|-------|------|
| 1. åˆ†æ | `/analyze-operator` | `logs/analyze_result.md` |
| 2. è§„åˆ’ | `/plan-and-confirm` | `logs/test_plan.md` |
| 3. ç¼–å†™éªŒè¯ | `/write-and-verify` | `test_<opname>.py` + `test_config.json` + `logs/verify_result.md` |
| 4. æ‰©å±•æŠ¥å‘Š | `/extend-and-report` | CSV + `logs/test_report.md` |

---

## æ ¸å¿ƒè®¾è®¡ï¼šè¾“å…¥æŠ½è±¡åŒ–

```python
# æµ‹è¯•æ–‡ä»¶ç»“æ„
def make_inputs(**config):
    """ç»Ÿä¸€è¾“å…¥æ„é€ ï¼Œä¸åŒæµ‹è¯•ä»…æ”¹å˜å‚æ•°"""
    pass

def run_cpu(**config): ...
def run_npu(**config): ...

TEST_CONFIGS = [
    {"name": "baseline", ...},  # å¤ç° __main__
    {"name": "small", ...},     # æ‰©å±•ç”¨ä¾‹
]
```

---

## ç”¨æˆ·äº¤äº’ç¤ºä¾‹

### é˜¶æ®µ 1 å®Œæˆå
```
ğŸ“– ç®—å­åˆ†æç»“æœ

å…¥å£å‡½æ•°ï¼š
- CPU: xxx_cpu(x, weight, bias)
- NPU: xxx_npu(x, weight, bias)

é»˜è®¤é…ç½®ï¼šbatch=4, seq=128, hidden=256

â“ è¯·ç¡®è®¤åç»§ç»­è§„åˆ’é˜¶æ®µã€‚
```

### é˜¶æ®µ 2 å®Œæˆå
```
ğŸ“‹ æµ‹è¯•è®¡åˆ’

åŸºç¡€æµ‹è¯•ï¼šå¤ç° __main__
æ‰©å±•æµ‹è¯•ï¼š6 ä¸ªç”¨ä¾‹

â“ è¯·æ‰¹å‡†æˆ–è°ƒæ•´ã€‚
```

### é˜¶æ®µ 3 å®Œæˆå
```
âœ… Baseline éªŒè¯é€šè¿‡

æµ‹è¯•æ–‡ä»¶ï¼štest_xxx.py
ç»“æœï¼šPASS (max_diff=1.2e-7)

â“ è¯·ç¡®è®¤åç»§ç»­æ‰©å±•æµ‹è¯•ã€‚
```

### é˜¶æ®µ 4 å®Œæˆå
```
âœ… æµ‹è¯•å®Œæˆï¼š6/6 é€šè¿‡

ğŸ“ äº§ç‰©ï¼š
- CSVï¼šresults_xxx_20260205.csv
- æŠ¥å‘Šï¼šlogs/test_report.md

è¯·å›å¤ "å®Œæˆ" ç»“æŸã€‚
```

---

## é‡è¦è§„åˆ™

1. **æŒ‰é¡ºåºæ‰§è¡Œ**ï¼šåˆ†æ â†’ è§„åˆ’ â†’ ç¼–å†™éªŒè¯ â†’ æ‰©å±•æŠ¥å‘Š
2. **æ¯é˜¶æ®µç­‰å¾…ç”¨æˆ·ç¡®è®¤**
3. **Baseline å¿…é¡»å…ˆé€šè¿‡**ï¼šå¤ç°åŸ `__main__` æµ‹è¯•åæ‰èƒ½æ‰©å±•
4. **ä¸ç¡®å®šçš„ç‚¹ä¸»åŠ¨è¯¢é—®ç”¨æˆ·**
5. **ç”¨æˆ·åé¦ˆæ²‰æ·€åˆ°å¯¹åº”äº§ç‰©ä¸­**
6. **ä¸ä¿®æ”¹ç›®æ ‡ç®—å­ä»£ç ** - åªä¿®æ”¹æµ‹è¯•æ–‡ä»¶
7. **å¯¹æ¯”æ¨ç†ä¿®æ­£** - éªŒè¯å¤±è´¥æ—¶ï¼Œä»åŸç®—å­å®ç°å¯¹æ¯”æ¨ç†å·®å¼‚

---

## é˜²å¹»è§‰åŸåˆ™ï¼ˆTDDï¼‰

> [!CAUTION]
> 1. **å…ˆè¿è¡Œï¼Œåæ¨ç†** - è¿è¡ŒåŸ `__main__` è·å–æœŸæœ›è¾“å‡ºï¼Œä¸å‡è®¾
> 2. **ä¸å‡è®¾å‚æ•°** - ä»è¿è¡Œç»“æœåæ¨ï¼Œè€Œéä»ä»£ç æ¨æ–­
> 3. **ä¸å‡è®¾è¾“å‡º** - å¿…é¡»è¿è¡ŒåŸä»£ç è·å–æœŸæœ›å€¼
> 4. **ä¿ç•™è¯æ®** - æœŸæœ›å€¼ä¿å­˜åˆ° `logs/expected_output.json`ï¼Œå¯è¿½æº¯
> 5. **é€é¡¹å¯¹æ¯”** - éªŒè¯æ—¶æŒ‰ shape â†’ dtype â†’ values é¡ºåºæ£€æŸ¥

---

## äº§ç‰©æ±‡æ€»

| äº§ç‰© | é˜¶æ®µ | è¯´æ˜ |
|------|------|------|
| `logs/analyze_result.md` | åˆ†æ | åˆ†æç»“æœ |
| `logs/expected_output.json` | åˆ†æ | æœŸæœ›è¾“å‡ºï¼ˆTDD åŸºå‡†ï¼‰ |
| `logs/test_plan.md` | è§„åˆ’ | æµ‹è¯•è®¡åˆ’ |
| `test_<opname>.py` | ç¼–å†™éªŒè¯ | æµ‹è¯•æ–‡ä»¶ |
| `test_config.json` | ç¼–å†™éªŒè¯ | æµ‹è¯•é…ç½® |
| `logs/verify_result.md` | ç¼–å†™éªŒè¯ | éªŒè¯ç»“æœ |
| `results_<opname>_<ts>.csv` | æ‰©å±•æŠ¥å‘Š | è¯¦ç»†æµ‹è¯•ç»“æœ |
| `logs/test_report.md` | æ‰©å±•æŠ¥å‘Š | æµ‹è¯•æŠ¥å‘Š |
